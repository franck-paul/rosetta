"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const r=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===r?null:r[1]||0}function t(e,t,a,o){return dotclear.servicesGet("getTranslationRow",(e=>{const t=(new DOMParser).parseFromString(e,"text/xml");if($("rsp[status=failed]",t).length>0)return void window.console.log("Dotclear REST server error");if(!Number($("rsp>rosetta",t).attr("ret")))return;const a=$("rsp>rosetta",t).attr("msg");return $(o).append(a),$(`${o} tr:last td:last a`).bind("click",(function(e){r($(this)),e.preventDefault()})),!0}),{id:e,lang:t,rosetta_id:a}),null}function r(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const r=t.attr("href"),a=t.parent().parent();dotclear.servicesPost("removeTranslation",(e=>{const t=(new DOMParser).parseFromString(e,"text/xml");if($("rsp[status=failed]",t).length>0)return void window.console.log("Dotclear REST server error");const r=Number($("rsp>rosetta",t).attr("ret")),o=$("rsp>rosetta",t).attr("msg");r?a.remove():window.alert(o)}),{id:e(r,"id"),lang:e(r,"lang"),rosetta_id:e(r,"rosetta_id"),rosetta_lang:e(r,"rosetta_lang")})}$("#edit-entry").on("onetabload",(()=>{$("#rosetta-area > label").toggleWithLegend($("#rosetta-area").children().not("label"),{user_pref:"dcx_post_rosetta",legend_click:!0,hide:!1})})),$("a.rosetta-remove").on("click",(function(e){r($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(r){const a=$(this).attr("href"),o=e(a,"id"),s=e(a,"lang"),n=e(a,"type"),l=document.getElementById("rosetta_url"),i=window.open(`${dotclear.rosetta.popup_posts_url}${n}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(!i.closed)return;clearInterval(d);const r=e(l.value,"id");null!==r&&""!==r&&(l.value=l.defaultValue,dotclear.servicesPost("addTranslation",(e=>{const a=(new DOMParser).parseFromString(e,"text/xml");if($("rsp[status=failed]",a).length>0)return void window.console.log("Dotclear REST server error");const n=Number($("rsp>rosetta",a).attr("ret")),l=$("rsp>rosetta",a).attr("msg");n?t(o,s,r,"#rosetta-list"):window.alert(l)}),{id:o,lang:s,rosetta_id:r}))}),500);r.preventDefault()})),$("a.rosetta-new").on("click",(function(r){const a=$(this).attr("href"),o=e(a,"id"),s=e(a,"lang"),n=e(a,"type"),l=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(a,"edit")),u=window.open(`${dotclear.rosetta.plugin_url}&type=${n}&id=${o}&lang=${s}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),c=setInterval((()=>{u.closed&&(clearInterval(c),null!==l.value&&""!==l.value&&null!==i.value&&""!==i.value&&dotclear.servicesPost("newTranslation",(e=>{const r=(new DOMParser).parseFromString(e,"text/xml");if($("rsp[status=failed]",r).length>0)return void window.console.log("Dotclear REST server error");const a=Number($("rsp>rosetta",r).attr("ret")),n=$("rsp>rosetta",r).attr("msg");if(a){const e=Number($("rsp>rosetta",r).attr("id"));if(t(o,s,e,"#rosetta-list"),d){const e=$("rsp>rosetta",r).attr("edit");window.location.href=e}return l.value=l.defaultValue,void(i.value=i.defaultValue)}l.value=l.defaultValue,i.value=i.defaultValue,window.alert(n)}),{id:o,lang:s,type:n,rosetta_title:l.value,rosetta_lang:i.value}))}),500);r.preventDefault()}))}));
