"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const a=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===a?null:a[1]||0}function t(e,t,r,n){return dotclear.jsonServicesPost("getTranslationRow",(e=>{if(e.ret)return $(n).append(e.msg),$(`${n} tr:last td:last a`).on("click",(function(e){a($(this)),e.preventDefault()})),!0}),{id:e,lang:t,rosetta_id:r}),null}function a(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const a=t.attr("href"),r=t.parent().parent();dotclear.jsonServicesPost("removeTranslation",(e=>{e.ret?r.remove():window.alert(e.msg)}),{id:e(a,"id"),lang:e(a,"lang"),rosetta_id:e(a,"rosetta_id"),rosetta_lang:e(a,"rosetta_lang")})}$.fn.toggleWithDetailsRosetta=function(e){const t=this,a={unfolded_sections:dotclear.unfolded_sections,hide:!0,fn:!1,user_pref:!1,reverse_user_pref:!1},r=$.extend(a,e);r.user_pref&&void 0!==r.unfolded_sections&&r.user_pref in r.unfolded_sections&&(r.hide=r.reverse_user_pref);const n=()=>{!r.hide&&r.fn&&(r.fn.apply(t),r.fn=!1),r.hide=!r.hide};return this.each((()=>{$(t).on("toggle",(e=>(r.user_pref&&dotclear.jsonServicesPost("setSectionFold",(()=>{}),{section:r.user_pref,value:r.hide^r.reverse_user_pref?1:0}),n(),e.preventDefault(),!1))),n()}))},$("#edit-entry").on("onetabload",(()=>{$("#rosetta-details").toggleWithDetailsRosetta({user_pref:"dcx_post_rosetta",hide:0!==$("#rosetta-list tbody").children().length})})),$("a.rosetta-remove").on("click",(function(e){a($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(a){const r=$(this).attr("href"),n=e(r,"id"),o=e(r,"lang"),l=e(r,"type"),s=document.getElementById("rosetta_url"),i=window.open(`${dotclear.rosetta.popup_posts_url}${l}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(!i.closed)return;clearInterval(d);const a=e(s.value,"id");null!==a&&""!==a&&(s.value=s.defaultValue,dotclear.jsonServicesPost("addTranslation",(e=>{e.ret?t(n,o,a,"#rosetta-list"):window.alert(e.msg)}),{id:n,lang:o,rosetta_id:a}))}),500);a.preventDefault()})),$("a.rosetta-new").on("click",(function(a){const r=$(this).attr("href"),n=e(r,"id"),o=e(r,"lang"),l=e(r,"type"),s=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(r,"edit")),u=window.open(`${dotclear.rosetta.plugin_url}&type=${l}&id=${n}&lang=${o}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),c=setInterval((()=>{u.closed&&(clearInterval(c),null!==s.value&&""!==s.value&&null!==i.value&&""!==i.value&&dotclear.jsonServicesPost("newTranslation",(e=>{if(e.ret)return t(n,o,e.id,"#rosetta-list"),d&&(window.location.href=e.edit),s.value=s.defaultValue,void(i.value=i.defaultValue);s.value=s.defaultValue,i.value=i.defaultValue,window.alert(e.msg)}),{id:n,lang:o,type:l,rosetta_title:s.value,rosetta_lang:i.value}))}),500);a.preventDefault()}))}));
