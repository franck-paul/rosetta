"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const r=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===r?null:r[1]||0}function t(e,t,a,n){return dotclear.jsonServicesPost("getTranslationRow",(e=>{if(e.ret)return $(n).append(e.msg),$(`${n} tr:last td:last a`).on("click",(function(e){r($(this)),e.preventDefault()})),!0}),{id:e,lang:t,rosetta_id:a}),null}function r(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const r=t.attr("href"),a=t.parent().parent();dotclear.jsonServicesPost("removeTranslation",(e=>{e.ret?a.remove():window.alert(e.msg)}),{id:e(r,"id"),lang:e(r,"lang"),rosetta_id:e(r,"rosetta_id"),rosetta_lang:e(r,"rosetta_lang")})}"function"!==$.fn.toggleWithDetails&&($.fn.toggleWithDetails=function(e){const t=this,r={unfolded_sections:dotclear.unfolded_sections,hide:!0,fn:!1,user_pref:!1,reverse_user_pref:!1},a=$.extend(r,e);if(!t)return this;const n=a.hide^a.reverse_user_pref;a.user_pref&&void 0!==a.unfolded_sections&&a.user_pref in a.unfolded_sections&&(a.hide=a.reverse_user_pref);const o=()=>{a.hide?t.attr("open",!1):(t.attr("open",!0),a.fn&&(a.fn.apply(t),a.fn=!1)),a.hide=!a.hide};return this.each((()=>{$(t).on("click",(e=>(a.user_pref&&n&&dotclear.jsonServicesPost("setSectionFold",(()=>{}),{section:a.user_pref,value:a.hide^a.reverse_user_pref?1:0}),o(),e.preventDefault(),!1))),o()}))}),$("#edit-entry").on("onetabload",(()=>{$("#rosetta-details").toggleWithDetails({user_pref:"dcx_post_rosetta",hide:!1})})),$("a.rosetta-remove").on("click",(function(e){r($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(r){const a=$(this).attr("href"),n=e(a,"id"),o=e(a,"lang"),s=e(a,"type"),l=document.getElementById("rosetta_url"),i=window.open(`${dotclear.rosetta.popup_posts_url}${s}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(!i.closed)return;clearInterval(d);const r=e(l.value,"id");null!==r&&""!==r&&(l.value=l.defaultValue,dotclear.jsonServicesPost("addTranslation",(e=>{e.ret?t(n,o,r,"#rosetta-list"):window.alert(e.msg)}),{id:n,lang:o,rosetta_id:r}))}),500);r.preventDefault()})),$("a.rosetta-new").on("click",(function(r){const a=$(this).attr("href"),n=e(a,"id"),o=e(a,"lang"),s=e(a,"type"),l=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(a,"edit")),u=window.open(`${dotclear.rosetta.plugin_url}&type=${s}&id=${n}&lang=${o}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),c=setInterval((()=>{u.closed&&(clearInterval(c),null!==l.value&&""!==l.value&&null!==i.value&&""!==i.value&&dotclear.jsonServicesPost("newTranslation",(e=>{if(e.ret)return t(n,o,e.id,"#rosetta-list"),d&&(window.location.href=e.edit),l.value=l.defaultValue,void(i.value=i.defaultValue);l.value=l.defaultValue,i.value=i.defaultValue,window.alert(e.msg)}),{id:n,lang:o,type:s,rosetta_title:l.value,rosetta_lang:i.value}))}),500);r.preventDefault()}))}));
