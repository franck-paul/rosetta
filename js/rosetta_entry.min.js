"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const a=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===a?null:a[1]||0}function t(e,t,r,o){return $.get("services.php",{f:"getTranslationRow",xd_check:dotclear.nonce,id:e,lang:t,rosetta_id:r}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const t=Number($("rsp>rosetta",e).attr("ret")),r=$("rsp>rosetta",e).attr("msg");return t?($(o).append(r),$(`${o} tr:last td:last a`).bind("click",(function(e){a($(this)),e.preventDefault()})),!0):void 0})).fail(((e,t,a)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${a})`)})).always((()=>{})),null}function a(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const a=t.attr("href"),r=t.parent().parent(),o=e(a,"id"),s=e(a,"lang"),n=e(a,"rosetta_id"),l=e(a,"rosetta_lang");$.get("services.php",{f:"removeTranslation",xd_check:dotclear.nonce,id:o,lang:s,rosetta_id:n,rosetta_lang:l}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const t=Number($("rsp>rosetta",e).attr("ret")),a=$("rsp>rosetta",e).attr("msg");t?r.remove():window.alert(a)})).fail(((e,t,a)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${a})`)})).always((()=>{}))}$("#edit-entry").on("onetabload",(()=>{$("#rosetta-area > label").toggleWithLegend($("#rosetta-area").children().not("label"),{user_pref:"dcx_post_rosetta",legend_click:!0,hide:!1})})),$("a.rosetta-remove").on("click",(function(e){a($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(a){const r=$(this).attr("href"),o=e(r,"id"),s=e(r,"lang"),n=e(r,"type"),l=document.getElementById("rosetta_url"),i=window.open(`popup_posts.php?popup=1&plugin_id=rosetta&type=${n}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(i.closed){clearInterval(d);const a=e(l.value,"id");null!==a&&""!==a&&(l.value=l.defaultValue,$.get("services.php",{f:"addTranslation",xd_check:dotclear.nonce,id:o,lang:s,rosetta_id:a}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const r=Number($("rsp>rosetta",e).attr("ret")),n=$("rsp>rosetta",e).attr("msg");r?t(o,s,a,"#rosetta-list"):window.alert(n)})).fail(((e,t,a)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${a})`)})).always((()=>{})))}}),500);a.preventDefault()})),$("a.rosetta-new").on("click",(function(a){const r=$(this).attr("href"),o=e(r,"id"),s=e(r,"lang"),n=e(r,"type"),l=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(r,"edit")),c=window.open("plugin.php?p=rosetta&popup_new=1&popup=1&plugin_id=rosetta&type="+n+"&id="+o+"&lang="+s,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),u=setInterval((()=>{c.closed&&(clearInterval(u),null!==l.value&&""!==l.value&&null!==i.value&&""!==i.value&&$.get("services.php",{f:"newTranslation",xd_check:dotclear.nonce,id:o,lang:s,type:n,rosetta_title:l.value,rosetta_lang:i.value}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const a=Number($("rsp>rosetta",e).attr("ret")),r=$("rsp>rosetta",e).attr("msg");if(a){const a=Number($("rsp>rosetta",e).attr("id"));if(t(o,s,a,"#rosetta-list"),d){const t=$("rsp>rosetta",e).attr("edit");window.location.href=t}}else window.alert(r)})).fail(((e,t,a)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${a})`)})).always((()=>{l.value=l.defaultValue,i.value=i.defaultValue})))}),500);a.preventDefault()}))}));
