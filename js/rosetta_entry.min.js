"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const a=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===a?null:a[1]||0}function t(e,t,l,r){return dotclear.jsonServicesPost("getTranslationRow",(e=>{if(e.ret)return $(r).append(e.msg),$(`${r} tr:last td:last a`).on("click",(function(e){a($(this)),e.preventDefault()})),!0}),{id:e,lang:t,rosetta_id:l}),null}function a(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const a=t.attr("href"),l=t.parent().parent();dotclear.jsonServicesPost("removeTranslation",(e=>{e.ret?l.remove():window.alert(e.msg)}),{id:e(a,"id"),lang:e(a,"lang"),rosetta_id:e(a,"rosetta_id"),rosetta_lang:e(a,"rosetta_lang")})}$("#edit-entry").on("onetabload",(()=>{$("#rosetta-details").toggleWithDetails({user_pref:"dcx_post_rosetta",hide:0!==$("#rosetta-list tbody").children().length})})),$("a.rosetta-remove").on("click",(function(e){a($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(a){const l=$(this).attr("href"),r=e(l,"id"),o=e(l,"lang"),n=e(l,"type"),s=document.getElementById("rosetta_url"),i=window.open(`${dotclear.rosetta.popup_posts_url}${n}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(!i.closed)return;clearInterval(d);const a=e(s.value,"id");null!==a&&""!==a&&(s.value=s.defaultValue,dotclear.jsonServicesPost("addTranslation",(e=>{e.ret?t(r,o,a,"#rosetta-list"):window.alert(e.msg)}),{id:r,lang:o,rosetta_id:a}))}),500);a.preventDefault()})),$("a.rosetta-new").on("click",(function(a){const l=$(this).attr("href"),r=e(l,"id"),o=e(l,"lang"),n=e(l,"type"),s=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(l,"edit")),u=window.open(`${dotclear.rosetta.plugin_url}&type=${n}&id=${r}&lang=${o}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),c=setInterval((()=>{u.closed&&(clearInterval(c),null!==s.value&&""!==s.value&&null!==i.value&&""!==i.value&&dotclear.jsonServicesPost("newTranslation",(e=>{if(e.ret)return t(r,o,e.id,"#rosetta-list"),d&&(window.location.href=e.edit),s.value=s.defaultValue,void(i.value=i.defaultValue);s.value=s.defaultValue,i.value=i.defaultValue,window.alert(e.msg)}),{id:r,lang:o,type:n,rosetta_title:s.value,rosetta_lang:i.value}))}),500);a.preventDefault()}))}));
