"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const a=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===a?null:a[1]||0}function t(e,t,l,r){return dotclear.jsonServicesPost("getTranslationRow",(e=>{if(e.ret)return $(r).append(e.msg),$(`${r} tr:last td:last a`).on("click",(function(e){a($(this)),e.preventDefault()})),!0}),{id:e,lang:t,rosetta_id:l}),null}function a(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const a=t.attr("href"),l=t.parent().parent();dotclear.jsonServicesPost("removeTranslation",(e=>{e.ret?l.remove():window.alert(e.msg)}),{id:e(a,"id"),lang:e(a,"lang"),rosetta_id:e(a,"rosetta_id"),rosetta_lang:e(a,"rosetta_lang")})}$("#edit-entry").on("onetabload",(()=>{$("#rosetta-area > label").toggleWithLegend($("#rosetta-area").children().not("label"),{user_pref:"dcx_post_rosetta",legend_click:!0,hide:!1})})),$("a.rosetta-remove").on("click",(function(e){a($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(a){const l=$(this).attr("href"),r=e(l,"id"),n=e(l,"lang"),o=e(l,"type"),s=document.getElementById("rosetta_url"),d=window.open(`${dotclear.rosetta.popup_posts_url}${o}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),i=setInterval((()=>{if(!d.closed)return;clearInterval(i);const a=e(s.value,"id");null!==a&&""!==a&&(s.value=s.defaultValue,dotclear.jsonServicesPost("addTranslation",(e=>{e.ret?t(r,n,a,"#rosetta-list"):window.alert(e.msg)}),{id:r,lang:n,rosetta_id:a}))}),500);a.preventDefault()})),$("a.rosetta-new").on("click",(function(a){const l=$(this).attr("href"),r=e(l,"id"),n=e(l,"lang"),o=e(l,"type"),s=document.getElementById("rosetta_title"),d=document.getElementById("rosetta_lang"),i=Number(e(l,"edit")),u=window.open(`${dotclear.rosetta.plugin_url}&type=${o}&id=${r}&lang=${n}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),c=setInterval((()=>{u.closed&&(clearInterval(c),null!==s.value&&""!==s.value&&null!==d.value&&""!==d.value&&dotclear.jsonServicesPost("newTranslation",(e=>{if(e.ret)return t(r,n,e.id,"#rosetta-list"),i&&(window.location.href=e.edit),s.value=s.defaultValue,void(d.value=d.defaultValue);s.value=s.defaultValue,d.value=d.defaultValue,window.alert(e.msg)}),{id:r,lang:n,type:o,rosetta_title:s.value,rosetta_lang:d.value}))}),500);a.preventDefault()}))}));
