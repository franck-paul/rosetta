"use strict";dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_entry")),dotclear.mergeDeep(dotclear,dotclear.getData("rosetta_type")),$((()=>{function e(e,t){const r=new RegExp(`[?&]${t}=([^&#]*)`).exec(e);return null===r?null:r[1]||0}function t(e,t,a,o){return $.get("services.php",{f:"getTranslationRow",xd_check:dotclear.nonce,id:e,lang:t,rosetta_id:a}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");if(!Number($("rsp>rosetta",e).attr("ret")))return;const t=$("rsp>rosetta",e).attr("msg");return $(o).append(t),$(`${o} tr:last td:last a`).bind("click",(function(e){r($(this)),e.preventDefault()})),!0})).fail(((e,t,r)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${r})`)})).always((()=>{})),null}function r(t){if(!window.confirm(dotclear.msg.confirm_remove_rosetta))return!1;const r=t.attr("href"),a=t.parent().parent(),o=e(r,"id"),s=e(r,"lang"),n=e(r,"rosetta_id"),l=e(r,"rosetta_lang");$.get("services.php",{f:"removeTranslation",xd_check:dotclear.nonce,id:o,lang:s,rosetta_id:n,rosetta_lang:l}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const t=Number($("rsp>rosetta",e).attr("ret")),r=$("rsp>rosetta",e).attr("msg");t?a.remove():window.alert(r)})).fail(((e,t,r)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${r})`)})).always((()=>{}))}$("#edit-entry").on("onetabload",(()=>{$("#rosetta-area > label").toggleWithLegend($("#rosetta-area").children().not("label"),{user_pref:"dcx_post_rosetta",legend_click:!0,hide:!1})})),$("a.rosetta-remove").on("click",(function(e){r($(this)),e.preventDefault()})),$("a.rosetta-add").on("click",(function(r){const a=$(this).attr("href"),o=e(a,"id"),s=e(a,"lang"),n=e(a,"type"),l=document.getElementById("rosetta_url"),i=window.open(`${dotclear.rosetta.popup_posts_url}${n}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),d=setInterval((()=>{if(!i.closed)return;clearInterval(d);const r=e(l.value,"id");null!==r&&""!==r&&(l.value=l.defaultValue,$.get("services.php",{f:"addTranslation",xd_check:dotclear.nonce,id:o,lang:s,rosetta_id:r}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const a=Number($("rsp>rosetta",e).attr("ret")),n=$("rsp>rosetta",e).attr("msg");a?t(o,s,r,"#rosetta-list"):window.alert(n)})).fail(((e,t,r)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${r})`)})).always((()=>{})))}),500);r.preventDefault()})),$("a.rosetta-new").on("click",(function(r){const a=$(this).attr("href"),o=e(a,"id"),s=e(a,"lang"),n=e(a,"type"),l=document.getElementById("rosetta_title"),i=document.getElementById("rosetta_lang"),d=Number(e(a,"edit")),c=window.open(`${dotclear.rosetta.plugin_url}&type=${n}&id=${o}&lang=${s}`,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no"),u=setInterval((()=>{c.closed&&(clearInterval(u),null!==l.value&&""!==l.value&&null!==i.value&&""!==i.value&&$.get("services.php",{f:"newTranslation",xd_check:dotclear.nonce,id:o,lang:s,type:n,rosetta_title:l.value,rosetta_lang:i.value}).done((e=>{if($("rsp[status=failed]",e).length>0)return void window.console.log("Dotclear REST server error");const r=Number($("rsp>rosetta",e).attr("ret")),a=$("rsp>rosetta",e).attr("msg");if(r){const r=Number($("rsp>rosetta",e).attr("id"));if(t(o,s,r,"#rosetta-list"),d){const t=$("rsp>rosetta",e).attr("edit");window.location.href=t}}else window.alert(a)})).fail(((e,t,r)=>{window.console.log(`AJAX ${t} (status: ${e.status} ${r})`)})).always((()=>{l.value=l.defaultValue,i.value=i.defaultValue})))}),500);r.preventDefault()}))}));
